{% set active = 'edit' %}
{% extends 'base.html' %}

{% block title %}podcast-downloader web interface - EDIT{% endblock %}

{% block inpagetitle %}{% if is_new == 1 %}Add{% else %}Edit{% endif %}{% endblock %}

{% block content %}
    <div>
        {% if is_new == 1 or found == 1 %}
        <form method="post" class="form-inline">
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="id">ID</label>
                <div class="col-sm-10"><input type="text" name="id" id="id" value="{{ edit_id }}" readonly class="form-control-plaintext"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="name">Name</label>
                <div class="col-sm-10"><input type="text" name="name" id="name" class="form-control" placeholder="Name of the current podcast" value="{{ podcast["name"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="url">URL</label>
                <div class="col-sm-10"><input type="text" name="url" id="url" class="form-control" placeholder="URL of the current podcast" value="{{ podcast["url"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="min_size">Minimal size</label>
                <div class="col-sm-10"><input type="number" name="min_size" id="min_size" class="form-control" placeholder="Minimal size of the file to be downloaded (empty for none, in MB)" value="{{ podcast["min_size"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="max_size">Maximal size</label>
                <div class="col-sm-10"><input type="number" name="max_size" id="max_size" class="form-control" placeholder="Maximal size of the file to be downloaded (empty for none, in MB)" value="{{ podcast["max_size"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="min_duration">Minimal duration</label>
                <div class="col-sm-10"><input type="number" name="min_duration" id="min_duration" class="form-control" placeholder="Minimal duration of the podcast (empty for none, in seconds)" value="{{ podcast["min_duration"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="max_duration">Maximal duration</label>
                <div class="col-sm-10"><input type="number" name="max_duration" id="max_duration" class="form-control" placeholder="Maximal duration of the podcast (empty for none, in seconds)" value="{{ podcast["max_duration"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="published_time_before">Published time before </label>
                <div class="col-sm-10"><input type="time" step="1" name="published_time_before" id="published_time_before" class="form-control" value="{{ published_time_before_time }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="published_time_after">Published time after</label>
                <div class="col-sm-10"><input type="time" step="1" name="published_time_after" id="published_time_after" class="form-control" value="{{ published_time_after_time }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="destination">Destination</label>
                <div class="col-sm-10"><input type="text" name="destination" id="destination" class="form-control" placeholder="Destination folder" value="{{ podcast["destination"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="include">Include</label>
                <div class="col-sm-10"><input type="text" name="include" id="include" class="form-control" placeholder="Regular expression to include" value="{{ podcast["include"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="exclude">Exclude</label>
                <div class="col-sm-10"><input type="text" name="exclude" id="exclude" class="form-control" placeholder="Regular expression to exclude" value="{{ podcast["exclude"] }}"></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="enabled">Enabled</label>
                <div class="col-sm-10"><input name="enabled" id="enabled" class="form-check-input" type="checkbox" {% if podcast["enabled"] == 1 or is_new == 1 %}checked{% endif %}></div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="enabled">Download days</label>
                <div class="col-sm-10">
                    <select name="download_days" id="download_days" multiple>
                        <option value="1" {%  if has_mon == 1 or is_new == 1 %}selected{% endif %}>Monday</option>
                        <option value="2" {%  if has_tue == 1 or is_new == 1 %}selected{% endif %}>Tuesday</option>
                        <option value="4" {%  if has_wed == 1 or is_new == 1 %}selected{% endif %}>Wednesday</option>
                        <option value="8" {%  if has_thu == 1 or is_new == 1 %}selected{% endif %}>Thursday</option>
                        <option value="16" {% if has_fri == 1 or is_new == 1 %}selected{% endif %}>Friday</option>
                        <option value="32" {% if has_sat == 1 or is_new == 1 %}selected{% endif %}>Saturday</option>
                        <option value="64" {% if has_sun == 1 or is_new == 1 %}selected{% endif %}>Sunday</option>
                    </select>
                </div>
                <input type="hidden" id="total_days_value" name="total_days_value" value="{{ total_days_value }}"/>
            </div>
            <div class="form-group row">
                <input type="submit" value="Save">
            </div>
        </form>
        <script>

            $('#download_days').multiSelect({
                selectableHeader: '<div class="alert alert-danger">Ignored days</div>',
                selectionHeader: '<div class="alert alert-success">Download days</div>',

                afterSelect: function(values){
                    newValue = Number($("#total_days_value").val()) + Number(values);
                    $("#total_days_value").val(newValue);
                },
                afterDeselect: function(values){
                    newValue = Number($("#total_days_value").val()) - Number(values);
                    $("#total_days_value").val(newValue);
                }
            });
        </script>
        {% else %}
            <span>UUID is invalid</span>
        {% endif %}
    </div>
{% endblock %}
